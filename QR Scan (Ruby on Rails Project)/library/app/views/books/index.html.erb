<% content_for :title, 'Library Home' %>

<p id="notice"><%= notice %></p>

<div id="container">
<h1>EPI-USE Library Catalogue</h1>
  <br>
  <table style="width:80%">
    <thead>
    <tr>
      <th id="th_cover">Cover Image</th>
      <th id="th_title"><%= sortable 'title' %></th>
      <th id="th_author"><%= sortable 'author' %></th>
      <th id="th_date"><%= sortable 'published_date' %></th>
      <th id="th_date"><%= sortable 'date_checkout' %></th>
      <th id="th_checkout">Checked Out By</th>
      <th id="th_author">Click to View First Page</th>
      <% if current_user && current_user.is_admin? %>
      <th id="th_author">Generate QR Code</th>
        <th id="th_admin">Show</th>
        <th id="th_admin">Edit</th>
        <th id="th_admin">Destroy</th>
      <% end %>
    </tr>
    </thead>

    <tbody>
      <% @books.each do |book| %>
        <tr style="text-align: center;" class="<%= cycle('list_line_odd', 'list_line_even') %>">
          <td><%= image_tag(book.image_URL, :alt => 'Image not available') %></td>
          <td><strong><%= book.title %></strong><br><%= 'ISBN: ' + book.isbn %><br>
            <%= 'Publisher: ' + book.publisher %></td>
          <td><%= book.author %></td>
          <td><%=  book.published_date %></td>
          <td class="<%= book.date_checkout.nil? ? 'available' : 'not_available' %>">
            <%= book.date_checkout.blank? ? 'Available' : book.date_checkout %></td>
          <!--td>
          <%= book.users.each do |user| %>
            <br><%= user.first_name %>
          <% end %></td-->
          <td class="<%= book.users.blank? ? 'available' : 'not_available' %>">
            <%= book.users.blank? ? 'Available': book.users.map { |u| u.first_name + ' ' + u.last_name}.join(', ') %></td>
          <td><%= link_to 'View First Page', show_first_page_book_path(book.id), :class => 'table_button' %></td>
          <!-- <td><%= book.first_page_URL %></td> -->
          <% if current_user && current_user.is_admin? %>
              <td><%= link_to 'Generate QR Code', new_book_qr_code_path(book.id), :class => 'table_button' %></td>
          <td><%= link_to 'Show', book, :class=>'linkText'%></td>
          <td><%= link_to 'Edit', edit_book_path(book), :class=>'linkText' %></td>
          <td><%= link_to 'Destroy', book, method: :delete, data: { confirm: 'Are you sure?' }, :class=>'linkText' %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

<br>

<!--%= #link_to 'New Book', new_book_path %-->
</div>
